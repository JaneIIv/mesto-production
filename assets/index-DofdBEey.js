(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"98fa7808-1b20-41e6-9d28-d59ecbdb695f","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ee=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(p),W=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(p),te=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(p),oe=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(p),re=(e,t)=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(p),ne=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(p),se=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(p),ce=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),H=(e,{onPreviewPicture:t,onLikeCard:o,onDeleteCard:n},r)=>{const s=ce(),i=s.querySelector(".card__like-button"),c=s.querySelector(".card__control-button_type_delete"),l=s.querySelector(".card__image"),m=s.querySelector(".card__like-count");l.src=e.link,l.alt=e.name,s.querySelector(".card__title").textContent=e.name,m.textContent=e.likes?e.likes.length:0,e.likes&&e.likes.some(Y=>Y._id===r)&&i.classList.add("card__like-button_is-active");const b=e.owner&&e.owner._id===r;return b||c.remove(),o&&i.addEventListener("click",()=>o(i,e._id,m)),n&&b&&c.addEventListener("click",()=>n(s,e._id)),t&&l.addEventListener("click",()=>t({name:e.name,link:e.link})),s},z=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",z)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",z)},ae=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})},T=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},J=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},le=(e,t,o)=>{if(t.dataset.errorMessage&&!/^[A-Za-zА-Яа-яёЁ\s\-]*$/.test(t.value)){const r=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";T(e,t,r,o);return}t.validity.valid?J(e,t,o):T(e,t,t.validationMessage,o)},ie=e=>e.some(t=>t.dataset.errorMessage&&!/^[A-Za-zА-Яа-яёЁ\s\-]*$/.test(t.value)?!0:!t.validity.valid),V=(e,t)=>{e&&(e.disabled=!0,e.classList.add(t.inactiveButtonClass))},ue=(e,t)=>{e&&(e.disabled=!1,e.classList.remove(t.inactiveButtonClass))},$=(e,t,o)=>{t&&(ie(e)?V(t,o):ue(t,o))},de=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.length!==0&&($(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{le(e,r,t),$(o,n,t)})}))},E=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{J(e,r,t)}),V(n,t)},pe=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>{n.preventDefault()}),de(o,e)})};let g=null;const R=document.querySelector(".places__list"),w=document.querySelector(".popup_type_edit"),L=w.querySelector(".popup__form"),Z=L.querySelector(".popup__input_type_name"),K=L.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_new-card"),f=x.querySelector(".popup__form"),me=f.querySelector(".popup__input_type_card-name"),_e=f.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),O=I.querySelector(".popup__image"),fe=I.querySelector(".popup__caption"),ye=document.querySelector(".profile__edit-button"),he=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_edit-avatar"),S=A.querySelector(".popup__form"),Se=S.querySelector(".popup__input"),U=document.querySelector(".popup_type_remove-card"),ve=U.querySelector(".popup__form"),v=document.querySelector(".popup_type_info"),F=v.querySelector(".popup__title"),_=v.querySelector(".popup__info"),be=v.querySelector(".popup__text"),N=v.querySelector(".popup__list"),Le=document.querySelector(".logo");let q=null,k=null;const u=(e,t,o="Сохранение...",n="Сохранить")=>{e.textContent=t?o:n},G=({name:e,link:t})=>{O.src=t,O.alt=e,fe.textContent=e,y(I)},Ce=e=>{e.preventDefault();const t=e.submitter;u(t,!0),te(Z.value,K.value).then(o=>{P.textContent=o.name,B.textContent=o.about,d(w)}).catch(o=>{console.error("Ошибка:",o)}).finally(()=>{u(t,!1)})},ge=e=>{e.preventDefault();const t=e.submitter;u(t,!0),oe(Se.value).then(o=>{M.style.backgroundImage=`url(${o.avatar})`,d(A),S.reset()}).catch(o=>{console.error("Ошибка:",o)}).finally(()=>{u(t,!1)})},qe=e=>{e.preventDefault();const t=e.submitter;u(t,!0,"Создание...","Создать"),re(me.value,_e.value).then(o=>{R.prepend(H(o,{onPreviewPicture:G,onLikeCard:X,onDeleteCard:Q},g)),d(x),f.reset()}).catch(o=>{console.error("Ошибка:",o)}).finally(()=>{u(t,!1,"Создание...","Создать")})},Q=(e,t)=>{q=e,k=t,y(U)},X=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");se(t,n).then(r=>{e.classList.toggle("card__like-button_is-active"),o.textContent=r.likes.length}).catch(r=>console.error("Ошибка лайка:",r))},j=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),h=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.cloneNode(!0),r=n.querySelector(".popup__info-term"),s=n.querySelector(".popup__info-description");return r.textContent=e,s.textContent=t,n},ke=e=>{const o=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0),n=o.querySelector(".popup__list-item");return n.textContent=e,o},Ee=()=>{_.innerHTML="",N.innerHTML="",W().then(e=>{F.textContent="Статистика пользователей";const t=e.length;if(_.append(h("Всего карточек:",t.toString())),e.length>0){const c=[...e].sort((D,b)=>new Date(b.createdAt)-new Date(D.createdAt)),l=c[0],m=c[c.length-1];_.append(h("Первая создана:",j(new Date(m.createdAt)))),_.append(h("Последняя создана:",j(new Date(l.createdAt))))}const o={};e.forEach(c=>{const l=c.owner._id,m=c.owner.name;o[l]||(o[l]={name:m,count:0}),o[l].count++});const n=Object.keys(o).length;_.append(h("Всего пользователей:",n.toString()));const r=Object.values(o).map(c=>c.count),s=Math.max(...r);_.append(h("Максимум карточек от одного:",s.toString()));const i=Object.values(o).sort((c,l)=>l.count-c.count);be.textContent="Все пользователи:",i.forEach(c=>{N.append(ke(c.name))}),y(v)}).catch(e=>{console.log("Ошибка загрузки статистики:",e),F.textContent="Ошибка загрузки данных"})};L.addEventListener("submit",Ce);f.addEventListener("submit",qe);S.addEventListener("submit",ge);ye.addEventListener("click",()=>{Z.value=P.textContent,K.value=B.textContent,E(L,C),y(w)});M.addEventListener("click",()=>{S.reset(),E(S,C),y(A)});he.addEventListener("click",()=>{f.reset(),E(f,C),y(x)});ve.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;u(t,!0,"Удаление...","Да"),ne(k).then(()=>{q.remove(),d(U),q=null,k=null}).catch(o=>console.error("Ошибка удаления:",o)).finally(()=>{u(t,!1,"Удаление...","Да")})});Le.addEventListener("click",Ee);const we=document.querySelectorAll(".popup");we.forEach(e=>{ae(e)});const C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};pe(C);Promise.all([ee(),W()]).then(([e,t])=>{g=e._id,P.textContent=e.name,B.textContent=e.about,M.style.backgroundImage=`url(${e.avatar})`,t.forEach(o=>{R.append(H(o,{onPreviewPicture:G,onLikeCard:X,onDeleteCard:Q},g))})}).catch(e=>{console.error("Ошибка загрузки:",e)});
